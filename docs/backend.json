
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the LinguaTune application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "googleId": {
          "type": "string",
          "description": "The Google ID of the user, obtained from Google Login."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "userName": {
          "type": "string",
          "description": "The user's username."
        }
      },
      "required": [
        "id",
        "googleId",
        "email",
        "userName"
      ]
    },
    "CommunityProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CommunityProfile",
      "type": "object",
      "description": "Represents a user's community profile within the LinguaTune application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Community Profile, typically the same as the user's UID."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 CommunityProfile)"
        },
        "name": {
            "type": "string",
            "description": "The user's display name."
        },
        "bio": {
          "type": "string",
          "description": "A short biography of the user."
        },
        "nativeLanguage": {
          "type": "string",
          "description": "The user's native language."
        },
        "learningLanguage": {
          "type": "string",
          "description": "The language the user is learning."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "bio",
        "nativeLanguage",
        "learningLanguage"
      ]
    },
    "Story": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Story",
      "type": "object",
      "description": "Represents a story generated by the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Story entity."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who generated the story."
        },
        "level": {
          "type": "string",
          "description": "The difficulty level of the story (e.g., beginner, intermediate, advanced)."
        },
        "sourceLanguage": {
            "type": "string",
            "description": "The source language of the story."
        },
        "targetLanguage": {
            "type": "string",
            "description": "The target language of the story."
        },
        "nativeText": {
          "type": "string",
          "description": "The story text in the user's native language."
        },
        "translatedText": {
          "type": "string",
          "description": "The translated story text in the user's selected foreign language."
        },
        "audioUrl": {
          "type": "string",
          "description": "Public URL of the TTS-generated audio file stored in Firebase Storage."
        },
        "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the story was created."
        }
      },
      "required": [
        "id",
        "userId",
        "level",
        "sourceLanguage",
        "targetLanguage",
        "nativeText",
        "translatedText",
        "audioUrl",
        "createdAt"
      ]
    },
    "Community": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Community",
      "type": "object",
      "description": "Represents a user-created community in the federation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Community."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who created the community."
        },
        "name": {
          "type": "string",
          "description": "The name of the community."
        },
        "description": {
          "type": "string",
          "description": "A short description of the community."
        },
        "welcomeMessage": {
          "type": "string",
          "description": "A welcome message for new members."
        },
        "members": {
          "type": "array",
          "description": "A list of AI-generated members for the community.",
          "items": {
            "$ref": "#/backend/entities/Member"
          }
        }
      },
      "required": ["id", "ownerId", "name", "description", "members"]
    },
    "Member": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Member",
      "type": "object",
      "description": "Represents a member of a community.",
      "properties": {
        "name": {
          "type": "string",
          "description": "The member's unique name."
        },
        "role": {
          "type": "string",
          "description": "The member's role in the community."
        },
        "bio": {
          "type": "string",
          "description": "A short bio for the AI member."
        },
        "type": {
          "type": "string",
          "description": "The type of member.",
          "enum": ["AI", "human"]
        }
      },
      "required": ["name", "role", "bio", "type"]
    },
     "Message": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Message",
        "type": "object",
        "description": "Represents a message in a community chat.",
        "properties": {
            "id": { "type": "string" },
            "communityId": { "type": "string" },
            "userId": { "type": "string" },
            "userName": { "type": "string" },
            "userAvatarUrl": { "type": "string", "format": "uri" },
            "type": { "type": "string", "enum": ["text"], "description": "The type of message." },
            "text": { "type": "string", "description": "The content of a text message." },
            "createdAt": { "type": "string", "format": "date-time" },
            "status": { "type": "string", "enum": ["active", "done"], "description": "The status of the message." },
            "deleted": { "type": "boolean", "description": "Flag indicating if the message is soft-deleted." },
            "deletedAt": { "type": "string", "format": "date-time", "description": "The timestamp when the message was soft-deleted." }
        },
        "required": ["id", "communityId", "userId", "userName", "type", "createdAt", "status"]
     },
    "Comment": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Comment",
        "type": "object",
        "description": "Represents a comment on a message.",
        "properties": {
            "id": { "type": "string" },
            "userId": { "type": "string" },
            "userName": { "type": "string" },
            "userAvatarUrl": { "type": "string", "format": "uri" },
            "type": { "type": "string", "enum": ["text"], "description": "The type of comment." },
            "text": { "type": "string", "description": "The content of a text comment." },
            "createdAt": { "type": "string", "format": "date-time" },
            "deleted": { "type": "boolean", "description": "Flag indicating if the comment is soft-deleted." },
            "deletedAt": { "type": "string", "format": "date-time", "description": "The timestamp when the comment was soft-deleted." }
        },
        "required": ["id", "userId", "userName", "type", "createdAt"]
    },
    "Asset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Asset",
      "type": "object",
      "description": "Represents a physical or intellectual property asset in a user's treasury.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the asset." },
        "ownerId": { "type": "string", "description": "The UID of the user who owns the asset." },
        "name": { "type": "string", "description": "The name of the asset." },
        "description": { "type": "string", "description": "A detailed description of the asset." },
        "type": { "type": "string", "enum": ["physical", "ip"], "description": "The type of asset (physical or intellectual property)." },
        "value": { "type": "number", "description": "The estimated value of the asset in USD." },
        "createdAt": { "type": "string", "format": "date-time", "description": "The timestamp when the asset was declared." }
      },
      "required": ["id", "ownerId", "name", "description", "type", "value", "createdAt"]
    },
    "JoinRequest": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "JoinRequest",
        "type": "object",
        "description": "Represents a user's request to join a community.",
        "properties": {
            "id": { "type": "string", "description": "Unique ID for the join request." },
            "userId": { "type": "string", "description": "The UID of the user requesting to join." },
            "userName": { "type": "string", "description": "The name of the user requesting to join." },
            "userBio": { "type": "string", "description": "The bio of the user requesting to join." },
            "status": { "type": "string", "enum": ["pending", "approved", "rejected"], "description": "The status of the join request." },
            "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "userId", "userName", "userBio", "status", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. User documents are only accessible by the user themselves. Parameter 'userId' represents the unique identifier of the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/stories/{storyId}",
        "definition": {
          "entityName": "Story",
          "schema": {
            "$ref": "#/backend/entities/Story"
          },
          "description": "Stores story information for a specific user. A user can only access their own stories.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "storyId",
              "description": "The unique identifier for the story."
            }
          ]
        }
      },
       {
        "path": "/users/{userId}/assets/{assetId}",
        "definition": {
          "entityName": "Asset",
          "schema": {
            "$ref": "#/backend/entities/Asset"
          },
          "description": "Stores asset information for a specific user. A user can only access their own assets.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "assetId",
              "description": "The unique identifier for the asset."
            }
          ]
        }
      },
      {
        "path": "/community-profiles/{userId}",
        "definition": {
          "entityName": "CommunityProfile",
          "schema": {
            "$ref": "#/backend/entities/CommunityProfile"
          },
          "description": "Stores user community profiles. A user can read anyone's profile, but can only write to their own.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/communities/{communityId}",
        "definition": {
          "entityName": "Community",
          "schema": {
            "$ref": "#/backend/entities/Community"
          },
          "description": "Stores all communities in a top-level collection. Communities are publicly readable, but only the owner can update or delete their own community.",
          "params": [
            { "name": "communityId", "description": "The unique ID for the community." }
          ]
        }
      },
       {
        "path": "/communities/{communityId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": { "$ref": "#/backend/entities/Message" },
          "description": "Stores messages for a community.",
          "params": [
            { "name": "communityId", "description": "The ID of the community." },
            { "name": "messageId", "description": "The ID of the message." }
          ]
        }
      },
      {
        "path": "/communities/{communityId}/messages/{messageId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": { "$ref": "#/backend/entities/Comment" },
          "description": "Stores comments for a specific message.",
          "params": [
            { "name": "communityId", "description": "The ID of the community." },
            { "name": "messageId", "description": "The ID of the message being commented on." },
            { "name": "commentId", "description": "The ID of the comment." }
          ]
        }
      },
      {
        "path": "/communities/{communityId}/joinRequests/{requestId}",
        "definition": {
            "entityName": "JoinRequest",
            "schema": { "$ref": "#/backend/entities/JoinRequest" },
            "description": "Stores requests from users to join a community.",
            "params": [
                { "name": "communityId", "description": "The ID of the community." },
                { "name": "requestId", "description": "The ID of the join request." }
            ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed for scalability and discoverability. By placing `communities` in a top-level collection, they become publicly queryable, which is essential for search and join features. User-specific data, including stories and assets, is nested under `/users/{userId}` to ensure data privacy and allow for simple, secure queries. Public profiles are in `/community-profiles` to allow discoverability without exposing private user account details. Messages are stored in a subcollection under each community to keep them organized and contextual."
  }
}

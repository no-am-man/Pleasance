{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the LinguaTune application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "googleId": {
          "type": "string",
          "description": "The Google ID of the user, obtained from Google Login."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "userName": {
          "type": "string",
          "description": "The user's username."
        }
      },
      "required": [
        "id",
        "googleId",
        "email",
        "userName"
      ]
    },
    "CommunityProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CommunityProfile",
      "type": "object",
      "description": "Represents a user's community profile within the LinguaTune application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Community Profile."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 CommunityProfile)"
        },
        "bio": {
          "type": "string",
          "description": "A short biography of the user."
        },
        "nativeLanguage": {
          "type": "string",
          "description": "The user's native language."
        },
        "learningLanguage": {
          "type": "string",
          "description": "The language the user is learning."
        }
      },
      "required": [
        "id",
        "userId",
        "bio",
        "nativeLanguage",
        "learningLanguage"
      ]
    },
    "Story": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Story",
      "type": "object",
      "description": "Represents a story generated by the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Story entity."
        },
        "level": {
          "type": "string",
          "description": "The difficulty level of the story (e.g., beginner, intermediate, advanced)."
        },
        "nativeText": {
          "type": "string",
          "description": "The story text in the user's native language."
        },
        "translatedText": {
          "type": "string",
          "description": "The translated story text in the user's selected foreign language."
        },
        "audioUrl": {
          "type": "string",
          "description": "URL of the TTS-generated audio file for the translated story.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "level",
        "nativeText",
        "translatedText",
        "audioUrl"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. User documents are only accessible by the user themselves. Parameter 'userId' represents the unique identifier of the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/communityProfile",
        "definition": {
          "entityName": "CommunityProfile",
          "schema": {
            "$ref": "#/backend/entities/CommunityProfile"
          },
          "description": "Stores the community profile of a user. Only the user has access to this profile. Parameter 'userId' represents the unique identifier of the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/stories/{storyId}",
        "definition": {
          "entityName": "Story",
          "schema": {
            "$ref": "#/backend/entities/Story"
          },
          "description": "Stores story information. Parameter 'storyId' represents the unique identifier of the story.",
          "params": [
            {
              "name": "storyId",
              "description": "The unique identifier for the story."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability, adhering to the core principles and strategy mandates.  User data and community profiles are stored under `/users/{userId}`. Stories are stored in a top-level collection for easy querying and management. Path-based ownership is implemented for user-specific data. Specifically, the `CommunityProfile` data is located in `/users/{userId}/communityProfile` guaranteeing ownership. This approach eliminates the need for `get()` calls in security rules, which facilitates atomic operations and improves security rule debuggability. Segregation of concerns is achieved by separating user data from global content. The structure supports secure list operations by using path-based ownership, ensuring that only the owner can access a user's private data (QAPs)."
  }
}
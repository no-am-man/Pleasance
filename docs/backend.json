{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the LinguaTune application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "googleId": {
          "type": "string",
          "description": "The Google ID of the user, obtained from Google Login."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "userName": {
          "type": "string",
          "description": "The user's username."
        }
      },
      "required": [
        "id",
        "googleId",
        "email",
        "userName"
      ]
    },
    "CommunityProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CommunityProfile",
      "type": "object",
      "description": "Represents a user's community profile within the LinguaTune application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Community Profile."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 CommunityProfile)"
        },
        "bio": {
          "type": "string",
          "description": "A short biography of the user."
        },
        "nativeLanguage": {
          "type": "string",
          "description": "The user's native language."
        },
        "learningLanguage": {
          "type": "string",
          "description": "The language the user is learning."
        }
      },
      "required": [
        "id",
        "userId",
        "bio",
        "nativeLanguage",
        "learningLanguage"
      ]
    },
    "Story": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Story",
      "type": "object",
      "description": "Represents a story generated by the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Story entity."
        },
        "level": {
          "type": "string",
          "description": "The difficulty level of the story (e.g., beginner, intermediate, advanced)."
        },
        "nativeText": {
          "type": "string",
          "description": "The story text in the user's native language."
        },
        "translatedText": {
          "type": "string",
          "description": "The translated story text in the user's selected foreign language."
        },
        "audioUrl": {
          "type": "string",
          "description": "URL of the TTS-generated audio file for the translated story.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "level",
        "nativeText",
        "translatedText",
        "audioUrl"
      ]
    },
    "Community": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Community",
      "type": "object",
      "description": "Represents a user-created community in the federation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Community."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who created the community."
        },
        "name": {
          "type": "string",
          "description": "The name of the community."
        },
        "description": {
          "type": "string",
          "description": "A short description of the community."
        },
        "welcomeMessage": {
          "type": "string",
          "description": "A welcome message for new members."
        },
        "members": {
          "type": "array",
          "description": "A list of AI-generated members for the community.",
          "items": {
            "$ref": "#/backend/entities/Member"
          }
        }
      },
      "required": ["id", "ownerId", "name", "description", "members"]
    },
    "Member": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Member",
      "type": "object",
      "description": "Represents an AI-generated member of a community.",
      "properties": {
        "name": {
          "type": "string",
          "description": "The AI member's unique name."
        },
        "role": {
          "type": "string",
          "description": "The member's role in the community."
        },
        "bio": {
          "type": "string",
          "description": "A short bio for the AI member."
        }
      },
      "required": ["name", "role", "bio"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. User documents are only accessible by the user themselves. Parameter 'userId' represents the unique identifier of the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/communities/{communityId}",
        "definition": {
          "entityName": "Community",
          "schema": {
            "$ref": "#/backend/entities/Community"
          },
          "description": "Stores communities created by a user. Only the owner can create, read, update, or delete their communities.",
          "params": [
            { "name": "userId", "description": "The ID of the user who owns the community." },
            { "name": "communityId", "description": "The unique ID for the community." }
          ]
        }
      },
      {
        "path": "/stories/{storyId}",
        "definition": {
          "entityName": "Story",
          "schema": {
            "$ref": "#/backend/entities/Story"
          },
          "description": "Stores story information. Parameter 'storyId' represents the unique identifier of the story.",
          "params": [
            {
              "name": "storyId",
              "description": "The unique identifier for the story."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability. User data and their created communities are stored under `/users/{userId}` using a subcollection for communities. This path-based ownership simplifies security rules and ensures that a user can only access their own data. Global content like stories remains in a top-level collection."
  }
}
